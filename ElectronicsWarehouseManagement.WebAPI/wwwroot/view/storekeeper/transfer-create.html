<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Đơn Chuyển Kho</title>
    <style>
        body {
            font-family: Arial;
            background: #eef2f7;
            padding: 30px
        }

        .container {
            max-width: 1200px;
            margin: auto;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,.08)
        }

        .topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px
        }

        button {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: .2s
        }

        .back-btn {
            background: #6b7280;
            color: white
        }

            .back-btn:hover {
                background: #4b5563
            }

        .add-btn {
            background: #22c55e;
            color: white
        }

            .add-btn:hover {
                background: #16a34a
            }

        .remove-btn {
            background: #ef4444;
            color: white
        }

            .remove-btn:hover {
                background: #dc2626
            }

        .submit-btn {
            background: #7c3aed;
            color: white;
            font-size: 16px
        }

            .submit-btn:hover {
                background: #6d28d9
            }

        .form-row {
            display: grid;
            grid-template-columns: repeat(3,1fr);
            gap: 15px;
            margin-bottom: 20px
        }

        input, textarea {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            width: 100%
        }

        table {
            width: 100%;
            border-collapse: collapse
        }

        th, td {
            border: 1px solid #e5e7eb;
            padding: 8px;
            text-align: center
        }

        th {
            background: #f3f4f6
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="topbar">
            <h2>🔁 ĐƠN CHUYỂN KHO</h2>
            <button class="back-btn" onclick="goHome()">← Về Home</button>
        </div>

        <div class="form-row">
            <input placeholder="Mã đơn chuyển">
            <input type="date">
            <input placeholder="Kho nguồn">
            <input placeholder="Kho đích">
            <input placeholder="BIN nguồn">
            <input placeholder="Nhân viên thực hiện">
        </div>

        <table>
            <thead>
                <tr>
                    <th>Product ID</th>
                    <th>Tên sản phẩm</th>
                    <th>Số lượng</th>
                    <th>Đơn vị</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody id="bodyTable">
                <tr>
                    <td><input></td>
                    <td><input></td>
                    <td><input type="number" min="1"></td>
                    <td><input></td>
                    <td><button class="remove-btn" onclick="removeRow(this)">X</button></td>
                </tr>
            </tbody>
        </table>

        <button class="add-btn" onclick="addRow()">+ Thêm dòng</button>

        <br><br>
<textarea rows="3" placeholder="Ghi chú"></textarea>
        <br><br>

        <button class="submit-btn">💾 Lưu đơn chuyển</button>

    </div>
    <script>
        const BASE = "https://localhost:7297/api";

        function addRow() {
            const row = `
<tr>
<td><input type="number"></td>
<td><input></td>
<td><input type="number" min="1"></td>
<td><input></td>
<td><button class="remove-btn" onclick="removeRow(this)">X</button></td>
</tr>`;
            document.getElementById("bodyTable").insertAdjacentHTML("beforeend", row);
        }

        function removeRow(btn) { btn.closest("tr").remove(); }

        async function saveTransfer() {

            let rows = document.querySelectorAll("#bodyTable tr");
            let itemIds = [];

            rows.forEach(r => {
                let id = r.cells[0].querySelector("input").value;
                if (id) itemIds.push(parseInt(id));
            });

            const payload = {
                desc: "Transfer Order",
                warehouse_from_id: 1,
                warehouse_to_id: 2,
                item_ids: itemIds
            };

            try {
                const res = await fetch(BASE + "/storekeeper/create-transfer", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    credentials: "include",
                    body: JSON.stringify(payload)
                });

                if (!res.ok) {
                    alert("Error: " + res.status);
                    return;
                }

                const data = await res.json();
                alert("Tạo đơn chuyển thành công!");
                window.location = "transfer-list.html";
            }
            catch (err) {
                console.error(err);
                alert("Lỗi kết nối server");
            }
        }

        document.querySelector(".submit-btn").onclick = saveTransfer;
    </script>

</body>
</html>